# README

## **Description** 

This repository contains all the code and data needed to replicate the optimisation experiments conducted in our study, as well as the results we generated.
Please download entire repository and open NSGA2_bees.Rproj in order to run the code.

---
### **code/** 

Includes all new and modified functions required to run the model in R (NSGA2R package installation also required (Tsou, 2022)), as well as all code needed to replicate the analyses and plots included in the manuscript.

| Name | Description |
| --- | --- |
| **fitness/** | Includes all functions from the Poll4pop model required to run the fitness function in the NSGAII algorithm (original model code available at https://github.com/yclough/ecodeal). This was used in Gardner et al. (2020) and derived from Haussler et al. (2017) and Lonsdorf et al. (2009). fitness_crop_poll.R and getcropyieldsandincome.R are edited from the original functions in order to suit the needs of the experiment and the genetic algorithm. new_landscape.R is a new function which creates and saves a raster of a specified landscape with values of the optimised fields replaced with land cover codes as generated by the nsga2R function.|
| **nsga2r_edited/** | Contains edited functions of the original NSG2R algorithm (available at https://cran.r-project.org/web/packages/nsga2R/index.html), as described in the main paper. Edits are annotated in the code. |
| **Manuscript_Data_Analysis.R** | Contains all code needed to replicate the results of the data analysis reported in the results of the main paper. |
| **Manuscript_plots.R** | Contains all code needed to replicate the plots included in the main paper. |
| **cluster_code.sh** | contains code used to call the model on the Imperial College computing cluster. |
| **optim_fn.R** | Function to run multi-objective optimisation of a specified landscape |
| **Prepare_landscape.R** | Function to separate landcover data into fields which will be shuffled during optimisation and fields which won't be shuffled during optimisation |
| **Run_optimisation.R** | Script to run multi-objective optimisation of a specified arable landscape on an HPC cluster |

### **data/**
Includes all model data required to run the model in R, as well as to reproduce all analyses and plots included in the manuscript.

| Name | Description |
| --- | --- |
| SK86/ | Input rasters of the selected SK86 study landscape, including UKCEH crop cover, land cover and hedgerow maps. Arable margins and woodland boundaries (wed.tif) were both generated from these maps, as described in the main paper. |
| fitness/input_parameters | Original Poll4pop input parameters, as described in Gardner et al. (2020). (Note Landclass_ExpOp_GFS.csv and Translations.csv appear both here and in the main data/ folder as they were called during other functions/ analysis) |
| landcover_scores.csv | amalgamated scores attributed to each landcover class in the original Poll4pop model. Columns: "Species" is used by the model to reference "Species_name"; "Code_ExpOp_GFS" is the landcover code, which references the landcover type described in "Landclass_ExpOp_GFS"; "Flor_pX_b" describes the attractiveness score attributed to that guild in each season (the meaning of season 1,2, and 3 varies per guild). "Nest_per_ha" describes the predicted number of nests per hectare each landcover may provide each guild of bee. "Flor_Cov_PX_b" describes the floral cover score attributed by experts to each land cover type in each season. |
| landscapeMask.tif | is a raster which highlights the optimised region of the SK86 landscape. |
| optim_landcovers.csv | provides the land cover codes and names of the land cover types chosen to be included in the optimisation. |
| optims.csv | details each repeat of each optimisation that was run. Columns: "optim" states the objectives of that optimisation; "number" NA; "rep" which repeat of that set of objectives it was; "radius" the radius of the optimised region in teh study landscape (m) and "complete" whether that run of the optimisation was completed and hence included in analyses. |
| params.csv | NA |

### **results/** 

#### **optimisations/** 
Includes individual RDS files containing the 'raw' results of each separate numerical trial.

#### **results RDS file **
Compiles the results of the above RDS files (i.e. each repeat of each experiment), including the assignment of land covers to final landscape populations by field ('populations') or pixels ('pixels'), the fitness score of each optimised landscape ('fitnessScores') and the calculated patch density of each optimised landscape ('patchDensity'). Concatenated csv files also included (described below).

#### **CSV files:**

| Name | Description | Column names |
| --- | --- | --- |
|**fitnessScores.csv**| a CSV file containing the mean fitness score of each generation of landscapes for each objective in each optimisation experiment.| "gen": the generation within each optimisation being scored; "rank": the Pareto rank of the landscape being scored within the specified generation; "optim": the objectives of the optimisation; "radius" the radius of the optimised area within the study landscape; "rep" the repetition number of the experiment being run; "objective" the objective within the optimisation that's being scores; "score" the score attributed to that objective for that landscape by the fitness function. |
|**landcoverMeasures.csv**| a CSV file containing various landscape/ landcover metrics of each landcover type in each initial and final landscape in each optimisation.| "Code_ExpOp_GFS": the code of the land cover being measured; "pixels": the number of pixels within the landscape raster that the land cover takes up;	"optim": the objectives of the optimisation being run; 	"radius": the radius of the optimised area within the study landscape; "rep": the repetition number of the experiment being run; "pop": whether the first or last generation of the population in the optimisation is being analysed;	"landscape": the landscape within the population (n=50) being analysed; "clumpiness", "patchDensity", "patchNo", "patchArea", "classArea": landscape metrics calculated using the landscapeMetrics package in R.|
|**objective_scores.csv** / **objective_scores_optimised_region.csv**| CSV files scoring each solution landscape for each objective/landscape 'end-user' using the relevant algorithm fitness function. First across the whole landscape and second only in the optimised region.| "gnb": the score for ground-nesting bumblebees"; "tnb": the score for tree-nesting bumblebees; "gns": the score for ground-nesting solitary bees; "farmer": the score for farm income; "optim" the objectives of the optimisation being run; "rep" the repetition number of the optimisation being run; "landscape": the landscape within the population (n=50) being analysed |
|**patchDensity.csv**| a CSV file containing landscape metrics of each solution landscape, as determined using the "landscapemetrics" package in R (Hesselbarth et al., 2019).| see landcoverMeasures.csv -> same column names apply. |
|**populations.csv**| a CSV containing the land cover assigned to each field of each solution landscape in the final generation of each optimisation.| "landscape": the landscape within the population (n=50) being analysed; "optim": the objectives of the optimisation being run; "radius": the radius of the optimised area within the study landscape; "rep" the repetition number of the optimisation being run; "pop": whether the first or last generation of the population in the optimisation is being analysed; "field": the field within the optimised region of specified landscape being considered; "Code_ExpOp_GFS": the code of the land cover being measured. |



